<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Typing App</title>
  </head>
  <style>
    .typing-grid {
      display: grid;
      justify-content: center;
      align-content: center;
      grid-template-columns: repeat(3, 100px);
      grid-template-rows: repeat(3, 100px);
    }

    .typing-grid > button {
      font-size: 5rem;
      background-color: rgb(56, 82, 174);
    }
    body {
      display: grid;
      justify-content: center;
    }

    .result_Div {
      font-size: 2rem;
    }

    .game-over {
      font-size: 2rem;
      background-color: rgb(174, 56, 156);
    }
  </style>
  <body>
    <div class="typing-grid">
      <button class="typing-grid-btn" id="btn1">!!</button>
      <button class="typing-grid-btn" id="btn2">!!</button>
      <button class="typing-grid-btn" id="btn3">!!</button>
      <button class="typing-grid-btn" id="btn4">!!</button>
      <button class="typing-grid-btn" id="btn5">!!</button>
      <button class="typing-grid-btn" id="btn6">!!</button>
      <button class="typing-grid-btn" id="btn7">!!</button>
      <button class="typing-grid-btn" id="btn8">!!</button>
      <button class="typing-grid-btn" id="btn9">!!</button>
    </div>

    <div class="result_Div">
      <div id="correctKey_Count_Div">correctKey_Count_Div</div>
      <div id="wrongKey_Count_Div">wrongKey_Count_Div</div>
      <div id="accuracy_Div">Accuracy</div>

      <div id="score_Div">Score</div>
    </div>

    <div class="game-over" id="game-over"></div>
    <button id="newGame">Start A New Game</button>

    <script>
      document.addEventListener("DOMContentLoaded", keyInput);

      //random number
      function getRandomInt(max) {
        return Math.floor(Math.random() * max);
      }
      //keyboardInput
      function keyInput() {
        document.body.addEventListener("keydown", getKeyInput);
      }

      const global = {
        gg: "gg",
        score: 0,
        correctKey_Count: 0,
        wrongKey_Count: 0,
        allBtnArr: [],
        abcArr: ["a", "b", "c"],
      };

      const globalTimer = {
        halfSeconds: 500,
        twoSeconds: 2000,
      };

      function allBtn_func() {
        let allBtn = document.querySelectorAll(".typing-grid-btn");
        return allBtn;
      }

      function getKeyInput(ev) {
        let char = ev.key;
        let allBtn = allBtn_func();

        for (let eachBtn of allBtn) {
          if (eachBtn.innerHTML === char) {
            global.score++;
            // console.log(global.score);
            document.getElementById(
              "score_Div"
            ).innerHTML = `SCORE: ${global.score}`;
          }
          if (char === eachBtn.innerHTML) {
            eachBtn.innerHTML = "!!";
          }
        }

        let allBtnArr = global.allBtnArr;

        if (global.gg !== true) {
          accuratcyStat();
        }
        function accuratcyStat() {
          if (allBtnArr.includes(char)) {
            global.correctKey_Count++;
            // console.log(global.correctKey_Count);
            document.getElementById(
              "correctKey_Count_Div"
            ).innerHTML = `correctKey_Count: ${global.correctKey_Count}`;
          } else {
            global.wrongKey_Count++;
            // console.log(global.wrongKey_Count);
            document.getElementById(
              "wrongKey_Count_Div"
            ).innerHTML = `wrongKey_Count: ${global.wrongKey_Count}`;
          }
          document.getElementById(
            "accuracy_Div"
          ).innerHTML = `Accuracy: ${Math.floor(
            (global.correctKey_Count /
              (global.correctKey_Count + global.wrongKey_Count)) *
              100
          )}%`;
        }
      }

      //empty_btn_Check
      let empty_btn_Check = function () {
        let allBtn = allBtn_func();
        let empty_btn_Check_Arr = [];
        allBtn.forEach(x => {
          if (x.innerHTML === "!!") {
            empty_btn_Check_Arr.push(x.id);
          }
        });
        // console.log(empty_btn_Check_Arr);
        return empty_btn_Check_Arr;
      };

      //get random empty button
      let getRandomEmptyButton = function () {
        let empty_btn_Check_Arr = empty_btn_Check();
        let randomEmptyButton;
        if (empty_btn_Check_Arr.length > 0) {
          randomEmptyButton =
            empty_btn_Check_Arr[getRandomInt(empty_btn_Check_Arr.length)];
        }
        // console.log("randombtn" + randomEmptyButton);
        return randomEmptyButton;
      };

      //generate text
      function generateText() {
        empty_btn_Check();
        getRandomEmptyButton();
        let randomEmptyButton = getRandomEmptyButton();
        console.log("generateText Running");
        let abcArr = global.abcArr;

        if (randomEmptyButton !== undefined) {
          document.getElementById(randomEmptyButton).innerHTML =
            abcArr[getRandomInt(3)];
        }
      }

      //gameOver_Check

      function gameOver_Check() {
        let allBtn = allBtn_func();
        let allBtnArrUpdate = [];
        allBtn.forEach(x => allBtnArrUpdate.push(x.innerHTML));
        // console.log(allBtnArrUpdate);

        let allFilled;
        if (allBtnArrUpdate.includes("!!")) {
          allFilled = false;
        } else {
          allFilled = true;
        }

        console.log("allFilled" + allFilled);
        if (allFilled === true) {
          document.getElementById("game-over").innerHTML = "Game Over";
        }
        global.gg = allFilled; //all buttons filled= game over
        global.allBtnArr = allBtnArrUpdate;
      }

      //empty all buttons
      function resetAllButtons() {
        let allBtn = allBtn_func();
        for (let eachBtn of allBtn) {
          eachBtn.innerHTML = "!!";
        }
      }

      //start btn, run setInterval
      document.getElementById("newGame").addEventListener("click", startBtn);

      function startBtn() {
        function stopInterval() {
          console.log("gameOver_Check" + global.gg);
          if (global.gg) {
            setTimeout(resetAllButtons, globalTimer.halfSeconds);
            global.allBtnArr = [];
            clearInterval(set_gameOver_Check);
            clearInterval(set_generateText);
            clearInterval(set_stopInterval);
          }
        }

        let set_generateText = setInterval(
          generateText,
          globalTimer.twoSeconds
        );
        let set_gameOver_Check = setInterval(
          gameOver_Check,
          globalTimer.twoSeconds
        );
        let set_stopInterval = setInterval(
          stopInterval,
          globalTimer.twoSeconds
        );
      }

      // add typespeed meter, increasing level, rainbow
    </script>
  </body>
</html>
